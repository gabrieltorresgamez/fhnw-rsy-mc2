---
title: "RSY: MC2"
subtitle: "Studiengang Data Science (HS2022), FHNW"
author: "Jan Zwicky und Gabriel Torres"
date: "Letzte Aktualisierungen: `r format(Sys.time(), '%B %d, %Y')`"
output:
  bookdown::html_document2:
      code_folding: hide
      toc: true
      toc_depth: 3
      toc_float: true
      number_sections: true
editor_options: 
  chunk_output_type: console
---
<style>
#TOC {
  background-color: #F5F5F5;
  font-size: 16px;
}
#header{
  color: #708090;
  background-color: #F5F5F5;
  font-size: 30px;
}
body{
  color: #708090;
  background-color:#F5F5F5;
}
</style>

# Aufgabenstellung


# Daten lesen und Pakete Lesen

In diesem Abschnitt werden alle Pakete geladen.
```{r, message = FALSE, warning = FALSE}

#Pakete für Data wrangling und Visualisierung
library(data.table)
library(tidyverse)
library(ggplot2)
# recommender Systems
library(coop)
library(recommenderlab)
#Pakete für das HTML
library(bookdown)
library(knitr)
```

```{r setup, cache=TRUE}
knitr::opts_chunk$set(fit.align = 'left', cache = TRUE, warning = FALSE, message = FALSE)
```

```{r}
# Einlesen der CSV-Dateien
movies <- read.csv("ml-latest-small/movies.csv", sep = ",")
#links <- read.csv("ml-latest-small/links.csv", sep = ",")
ratings <- read.csv("ml-latest-small/ratings.csv", sep = ",")
#tags <- read.csv("ml-latest-small/tags.csv", sep = ",")
```

# EDA
## Welches sind die am häufigsten geschauten Filme?
```{r}
left_join(movies, ratings, "movieId")%>%
group_by(title,movieId,genres) %>%
summarise(count = n()) %>%
arrange(desc(count)) %>% 
head()
```
## Welches sind die am häufigsten geschauten Genres?

```{r}
movies%>%
  separate_rows(genres,sep = "[^-a-zA-Z0-9\\s]+", convert = FALSE) %>%
  filter(genres!= "")%>%
  group_by(genres) %>%
  summarise(count = n()) %>% 
  arrange(desc(count)) %>%
  head()

```
## Wie verteilen sich die mittleren Kundenratings pro Film

```{r}
mean_rating_movie <- ratings%>%
  group_by(movieId)%>%
  summarise(mean_rating = mean(rating))

ggplot(mean_rating_movie, aes(mean_rating))+
  geom_density()+
  labs(title = "Verteilung der mittleren Kundenratings pro Film",
       x = "Durchschnittliche Bewertung",
       y = "Verteilung")+
  theme_classic()
```

## Wie stark streuen die Ratings von individuellen Kunden?

```{r}
set.seed(100)
sample_values = sample(1:610,4,replace = FALSE)

ratings %>%
  filter(userId %in% sample_values)%>%
ggplot(., aes(rating))+
  geom_density(aes(color = factor(userId)))+
  labs(title = "Streuung von Bewertungen von Kunden",
       subtitle = "random sample",
       x = "Bewertung",
       y = "Verteilung",
       color = "User ID")+
  theme_classic()
```

## Welchen Einfluss hat die Normierung der Ratings pro Kunde auf deren Verteilung? (Auch Standartisieren?)


```{r}
user_mean_rating <- ratings%>%
  group_by(userId)%>%
  summarise(mean_rating = mean(rating))

user_mean_rating <-left_join(ratings,user_mean_rating)
user_mean_rating$normalised_rating <- user_mean_rating$rating - user_mean_rating$mean_rating

```

```{r}
random_user_ratings <- user_mean_rating %>%
  filter(userId %in% sample_values)
```


```{r}
ggplot(random_user_ratings, aes(normalised_rating,color = factor(userId)))+
  geom_density()+
  labs(title = "Streuung von Bewertungen von Kunden",
       subtitle = "random sample",
       x = "normalisierte Bewertung",
       y = "Verteilung",
       color ="User ID")+
  theme_classic()
```




##Welche strukturellen Charakteristika (z.B. Sparsity) und Auffälligkeiten zeigt die User-Item Matrix?

```{r}
user_item<-user_mean_rating %>%
  select(movieId,userId,normalised_rating)%>%
  pivot_wider(names_from = movieId, values_from = normalised_rating)
user_item[is.na(user_item)] <- 0
user_item <- user_item %>% 
  column_to_rownames(., var = "userId")
```
Die User-Item Matrix ist zu 98.3 % Sparse.
```{r}
sum(user_item == 0)/(dim(user_item)[1]*(dim(user_item)[2]))
```



# Datenreduktion
Die Daten wurden auf 400 Kunden und 700 Filme reduziert.
```{r}
set.seed(112)
user_item_reduction <- user_item[sample(nrow(user_item), 400), sample(ncol(user_item), 700)]
```
## Sparsity vor und nach Datenreduktion
Die Daten sind ähnlich Sparse wie die nicht reduzierten Daten.
```{r}
sum(user_item_reduction == 0)/(dim(user_item_reduction)[1]*(dim(user_item_reduction)[2]))
```

## Mittlere Kundenratings pro Film vor und nach Datenreduktion (Nicht mit 0 Normalisieren sonder mit 3 (Mittelwert))
```{r}
moviemeans_reducted <-colMeans(user_item_reduction)
moviemeans_reducted<-data.frame(moviemeans_reducted)
ggplot(moviemeans_reducted,aes(moviemeans_reducted))+
  geom_density()+
  labs(title = "Streuung von durchschnittlichen Bewertung von Filmen",
       subtitle = "reduzierter Datensatz",
       x = "durchschnittliche Bewertung",
       y = "Verteilung")+
  theme_classic()
```
```{r}
moviemeans <-rowMeans(user_item)
moviemeans<-data.frame(moviemeans)
ggplot(moviemeans,aes(moviemeans))+
  geom_density()+
  labs(title = "Streuung von durchschnittlichen Bewertung von Filmen",
       subtitle = "kompletter Datensatz",
       x = "durchschnittliche Bewertung",
       y = "Verteilung")+
  theme_classic()
```
