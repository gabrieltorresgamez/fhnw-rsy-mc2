---
title: "RSY: MC2"
subtitle: "Studiengang Data Science (HS2022), FHNW"
author: "Jan Zwicky und Gabriel Torres"
date: "Letzte Aktualisierungen: `r format(Sys.time(), '%B %d, %Y')`"
output:
  bookdown::html_document2:
      code_folding: hide
      toc: true
      toc_depth: 3
      toc_float: true
      number_sections: true
editor_options: 
  chunk_output_type: console
---
<style>
#TOC {
  background-color: #F5F5F5;
  font-size: 16px;
}
#header{
  color: #708090;
  background-color: #F5F5F5;
  font-size: 30px;
}
body{
  color: #708090;
  background-color:#F5F5F5;
}
</style>

# Aufgabenstellung


# Daten aufbereiten und Pakete Lesen
## Pakete Laden und Daten Einlesen
In diesem Abschnitt werden alle Pakete geladen.
```{r, message = FALSE, warning = FALSE}

#Pakete für Data wrangling und Visualisierung
library(tidyverse)
library(ggplot2)
#Pakete für das HTML
library(bookdown)
library(knitr)
```

```{r setup, cache=TRUE}
knitr::opts_chunk$set(fit.align = 'left', cache = TRUE, warning = FALSE, message = FALSE)
```


```{r}
# Einlesen der CSV-Dateien
movies <- read.csv("ml-latest-small/movies.csv", sep = ",")
links <- read.csv("ml-latest-small/links.csv", sep = ",")
ratings <- read.csv("ml-latest-small/ratings.csv", sep = ",")
tags <- read.csv("ml-latest-small/tags.csv", sep = ",")
```

Welches sind die am häufigsten geschauten Filme?
```{r}
most_viewed <- movies%>%
  group_by(title,movieId,genres)%>%
  count()%>%
  ungroup()%>%
  filter(n == max(n))
```
Welches sind die am häufigsten geschauten Genres?

```{r}
genres_sep <-movies%>%
  separate_rows(genres,sep = "[^-a-zA-Z0-9\\s]+", convert = FALSE) %>%
  filter(genres!= "")

ggplot(genres_sep,aes(genres))+
  geom_bar()
```
Wie verteilen sich die mittleren Kundenratings pro Film

```{r}
mean_rating_movie <- ratings%>%
  group_by(movieId)%>%
  summarise(mean_rating = mean(rating))

ggplot(mean_rating_movie, aes(mean_rating))+
  geom_density()
```

Wie stark streuen die Ratings von individuellen Kunden?

```{r}
set.seed(100)
sample_values = sample(1:610,4,replace = FALSE)

random_user_ratings <- ratings %>%
  filter(userId %in% sample_values)

ggplot(random_user_ratings, aes(rating))+
  geom_density(aes(color = factor(userId)))
```

Welchen Einfluss hat die Normierung der Ratings pro Kunde auf deren Verteilung? (Auch Standartisieren?)


```{r}
mean_rating_user <- ratings%>%
  group_by(userId)%>%
  summarise(mean_rating = mean(rating))

mean_rating_user$mean_rating<- 3-mean_rating_user$mean_rating

user_mean_rating <-left_join(ratings,mean_rating_user)

user_mean_rating$normalised_rating <- user_mean_rating$rating+ user_mean_rating$mean_rating

user_mean_rating<-user_mean_rating%>%
  select(userId,movieId,normalised_rating,timestamp)

```
```{r}
set.seed(100)
sample_values = sample(1:610,4,replace = FALSE)

random_user_ratings <- user_mean_rating %>%
  filter(userId %in% sample_values)

ggplot(random_user_ratings, aes(normalised_rating))+
  geom_density(aes(color = factor(userId)))
```


Welche strukturellen Charakteristika (z.B. Sparsity) und
Auffälligkeiten zeigt die User-Item Matrix?

```{r}
user_item<-pivot_wider(
  ratings,
  names_from  = userId,
  values_from  = rating)
```


Analyse User Item Matrix


https://cran.r-project.org/web/packages/rrecsys/vignettes/a1_dataset.html






```{r}
genres_sep$value <- 1
```

```{r}
new_genres <- genres_sep %>%
  pivot_wider(names_from = genres, values_from = value) %>%
  select(-"no genres listed")
new_genres[is.na(new_genres)] <- 0
```

```{r}
genres_sep$genres
```

